<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Tips</title>
<link href="../css/normalize.css" rel="stylesheet">
<link href="../css/github.css" rel="stylesheet">
<link href="../css/main.css" rel="stylesheet">
</head>

<body>

<!-- insertion below : menu.html -->
<header>
    <a href="/"><h1>So Chigusa</h1></a>
</header>
<nav id="global-nav">
  <ul>
    <a href="/cv/cv.pdf"><li>CV</li></a>
    <a href="/research/"><li>Research</li></a>
    <a href="/tips/"><li>Tips</li></a>
    <a href="/git/"><li>Git</li></a>
  </ul>
</nav>
<!-- insertion above : menu.html -->
  
<div class="container">
  <div class="box" id="tipsmenu">
    <!-- Tips menu below -->
    <nav>
      <h3>Tips Menu</h3>
      <ul>
      <li><a href="atom.html">atom</a></li>
      <li><a href="atom.html">atom</a></li>
      <li><a href="fastjet.html">fastjet</a></li>
      <li><a href="delphes.html">delphes</a></li>
      <li><a href="boost_icc.html">boost_icc</a></li>
      <li><a href="boost_odeint.html">boost_odeint</a></li>
      <li><a href="matplotlib.html">matplotlib</a></li>
      <li><a href="latex.html">latex</a></li>
      <li><a href="latex_japanese.html">latex_japanese</a></li>
      <li><a href="beamer.html">beamer</a></li>
      <li><a href="Mojave.html">Mojave</a></li>
      <li><a href="latexdiff.html">latexdiff</a></li>
      <li><a href="pythia8.html">pythia8</a></li>
      <li><a href="FeynArts.html">FeynArts</a></li>
      <li><a href="susy-hit.html">susy-hit</a></li>
      <li><a href="softsusy.html">softsusy</a></li>
      <li><a href="madgraph.html">madgraph</a></li>
      <li><a href="markdown-mode.html">markdown-mode</a></li>
      <li><a href="chrome-JavaScript.html">chrome-JavaScript</a></li>
       </ul>
    </nav>
    <!-- Tips menu above -->
  </div>
  <div class="box" id="gfm">
    <!-- Contents below -->
    <div id="content">
    <div class="article">
    <header id="title-block-header">
    <h1 class="title">Matplotlib を使いこなす</h1>
    </header>
    <hr />
    <h2 id="基本構文">基本構文</h2>
    <p><code>matplotlib</code> を読み込んで、図を描く準備をする部分。</p>
    <div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" title="1"><span class="im">import</span> matplotlib</a>
    <a class="sourceLine" id="cb1-2" title="2">matplotlib.use(<span class="st">&quot;Agg&quot;</span>)</a>
    <a class="sourceLine" id="cb1-3" title="3"><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</a>
    <a class="sourceLine" id="cb1-4" title="4"></a>
    <a class="sourceLine" id="cb1-5" title="5">fig <span class="op">=</span> plt.figure()</a>
    <a class="sourceLine" id="cb1-6" title="6">ax  <span class="op">=</span> fig.add_subplot(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)</a></code></pre></div>
    <p><code>matplotlib.axes.Axes</code> クラスのインスタンスである <code>ax</code> を用いて図を描いたら（下部参照）、図の設定は以下のように可能。</p>
    <div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" title="1">ax.set_title(<span class="vs">r&#39;title $\LaTeX$&#39;</span>, size<span class="op">=</span><span class="dv">25</span>)</a>
    <a class="sourceLine" id="cb2-2" title="2">ax.set_xlabel(<span class="st">&#39;xlabel&#39;</span>, size<span class="op">=</span><span class="dv">25</span>)</a>
    <a class="sourceLine" id="cb2-3" title="3">ax.set_ylabel(<span class="st">&#39;ylabel&#39;</span>, size<span class="op">=</span><span class="dv">25</span>)</a>
    <a class="sourceLine" id="cb2-4" title="4">ax.legend(loc<span class="op">=</span><span class="st">&quot;lower right&quot;</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</a>
    <a class="sourceLine" id="cb2-5" title="5">ax.tick_params(labelsize<span class="op">=</span><span class="dv">20</span>)</a></code></pre></div>
    <p>最後に PDF に保存し、確認のためにファイルを開く。</p>
    <div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" title="1">plt.tight_layout()</a>
    <a class="sourceLine" id="cb3-2" title="2">plt.show()</a>
    <a class="sourceLine" id="cb3-3" title="3">plt.savefig(<span class="st">&#39;hoge.pdf&#39;</span>)</a>
    <a class="sourceLine" id="cb3-4" title="4">commands.getoutput(<span class="st">&#39;open hoge.pdf&#39;</span>)</a></code></pre></div>
    <h2 id="描画データの準備">描画データの準備</h2>
    <p>CSV のような構造のデータが与えられていることをイメージする。 これを <code>numpy</code> で読み込んで使用する場合、</p>
    <div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb4-1" title="1">data <span class="op">=</span> np.loadtxt(<span class="st">&#39;hoge.dat&#39;</span>, skiprows<span class="op">=</span><span class="dv">1</span>, usecols<span class="op">=</span><span class="bu">range</span>(<span class="dv">2</span>))</a>
    <a class="sourceLine" id="cb4-2" title="2">x <span class="op">=</span> data[:,<span class="dv">0</span>]</a>
    <a class="sourceLine" id="cb4-3" title="3">y <span class="op">=</span> data[:,<span class="dv">1</span>]</a></code></pre></div>
    <p>などとする。<code>skiprows</code> オプションを使用することで、好きな数のヘッダー行を読み込み範囲から外せる。 また、<code>pandas</code> を用いる場合には、区切り文字が空白かタブかに応じて、</p>
    <div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb5-1" title="1">data <span class="op">=</span> pd.read_csv(<span class="st">&#39;hoge.dat&#39;</span>)</a>
    <a class="sourceLine" id="cb5-2" title="2">data <span class="op">=</span> pd.read_table(<span class="st">&#39;hoge.dat&#39;</span>)</a></code></pre></div>
    <p>とする。このとき、各データ列のヘッダーに変数名を書いておいて、<code>data['name']</code> で参照できる。 このデータを <code>numpy</code> リストにも変換できる。</p>
    <div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb6-1" title="1">nplist <span class="op">=</span> data.values</a></code></pre></div>
    <h2 id="基本の1d-plot">基本の1D plot</h2>
    <p>x,y 両軸のデータのリストをそれぞれ用意して、<code>plot</code> 関数を用いる。</p>
    <div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb7-1" title="1">ax.plot(xlist, ylist, color<span class="op">=</span><span class="st">&#39;r&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;-&#39;</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">&#39;hoge&#39;</span>)</a></code></pre></div>
    <p><code>label</code> オプションの文字列がレジェンドとして使用される。軸の範囲の設定は</p>
    <div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb8-1" title="1">ax.set_xbound(xmin, xmax)</a>
    <a class="sourceLine" id="cb8-2" title="2">ax.set_ybound(ymin, ymax)</a></code></pre></div>
    <p>対数目盛りの設定は</p>
    <div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb9-1" title="1">ax.set_xscale(<span class="st">&#39;log&#39;</span>)</a>
    <a class="sourceLine" id="cb9-2" title="2">ax.set_yscale(<span class="st">&#39;log&#39;</span>)</a></code></pre></div>
    <p>のように可能。軸の目盛りの位置と対応する文字列も必要に応じて指定できる。</p>
    <div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb10-1" title="1">ax.set_xticks([<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="fl">1.5</span>])</a>
    <a class="sourceLine" id="cb10-2" title="2">ax.set_yticks([<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="fl">1.5</span>])</a>
    <a class="sourceLine" id="cb10-3" title="3">ax.set_yticklabels([<span class="st">&#39;0.0&#39;</span>, <span class="st">&#39;0.5&#39;</span>, <span class="st">&#39;1.0&#39;</span>, <span class="st">&#39;1.5&#39;</span>])</a></code></pre></div>
    <p>また、補助線を引きたい時は <code>numpy</code> を使って</p>
    <div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb11-1" title="1">x <span class="op">=</span> np.linspace(xmin, xmax, npts)</a>
    <a class="sourceLine" id="cb11-2" title="2">y <span class="op">=</span> np.linspace(ymin, ymax, npts)</a></code></pre></div>
    <p>として作ったリストが使える。</p>
    <h2 id="等高線">等高線</h2>
    <p><code>matplotlib</code> で等高線をプロットするには、2次元リストに格納された x,y,z の値が必要。 もし用意されたデータが 1次元で、ただし秩序を保って並んでいるなら、</p>
    <div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb12-1" title="1">x,y,z <span class="op">=</span> data[:,<span class="dv">1</span>].reshape(ny,nx), data[:,<span class="dv">2</span>].reshape(ny,nx), data[:,<span class="dv">3</span>].reshape(ny,nx)</a></code></pre></div>
    <p>などと、<code>ndarray.reshape</code> 関数が使える。 さて、これを用いて等高線プロットは</p>
    <div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb13-1" title="1">cs <span class="op">=</span> ax.contour(x, y, z, levels<span class="op">=</span>[z1, z2, z3], colors<span class="op">=</span><span class="st">&#39;b&#39;</span>, linestyles<span class="op">=</span><span class="st">&#39;-&#39;</span>)</a>
    <a class="sourceLine" id="cb13-2" title="2">h,_   <span class="op">=</span> cs.legend_elements()</a>
    <a class="sourceLine" id="cb13-3" title="3">ax.legend([h[<span class="dv">0</span>]], [<span class="st">&#39;legend&#39;</span>], fontsize<span class="op">=</span><span class="dv">20</span>)</a></code></pre></div>
    <p>などとして描ける。レジェンドの他に、等高線の途中に対応する z の値を描くことも出来る。</p>
    <div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb14-1" title="1">ax.clabel(cs, fmt<span class="op">=</span><span class="st">&#39;</span><span class="sc">%d</span><span class="st">&#39;</span>)</a>
    <a class="sourceLine" id="cb14-2" title="2">ax.clabel(cs2, fmt<span class="op">=</span><span class="st">&#39;</span><span class="sc">%.1E</span><span class="st">&#39;</span>)</a></code></pre></div>
    <p>別の種類のプロットとして、等高線間の塗りつぶしも可能。そのためには</p>
    <div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb15-1" title="1">ax.contourf(x, y, z, levels<span class="op">=</span>[zmin,zmax], alpha<span class="op">=</span><span class="fl">0.3</span>, colors<span class="op">=</span><span class="st">&#39;gray&#39;</span>)</a></code></pre></div>
    <p>などとすると、<code>zmin &lt; z &lt; zmax</code> の領域を指定された色で塗りつぶす。 この時、場合によっては背景色を白以外の色にしておくと便利。</p>
    <div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb16-1" title="1">ax.set_axis_bgcolor(<span class="st">&#39;green&#39;</span>)</a></code></pre></div>
    <h2 id="ヒストグラム">ヒストグラム</h2>
    <p>ヒストグラムの描画のためには、1次元のデータリストを用意して、</p>
    <div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb17-1" title="1">ax.hist(data, bins<span class="op">=</span>nbin, <span class="bu">range</span><span class="op">=</span>(xmin, xmax), color<span class="op">=</span><span class="st">&#39;m&#39;</span>, label<span class="op">=</span><span class="st">&#39;legend&#39;</span>)</a></code></pre></div>
    <p>とする。各データを違うウェイトで足し合わせたい時は、データと同じ順序で同じ数のウェイトを格納したリスト <code>weights</code> を用意し、オプションを追加： <code>weights=weights</code>。</p>
    <h2 id="アスペクト比を変更する">アスペクト比を変更する</h2>
    <p>図の高さを幅の <code>aspect</code> 倍に変更したいとする。以下のようにすれば良い。</p>
    <div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb18-1" title="1">xmin, xmax <span class="op">=</span> ax.get_xlim()</a>
    <a class="sourceLine" id="cb18-2" title="2">ymin, ymax <span class="op">=</span> ax.get_ylim()</a>
    <a class="sourceLine" id="cb18-3" title="3">ax.set_aspect(<span class="bu">abs</span>((xmax<span class="op">-</span>xmin)<span class="op">/</span>(ymax<span class="op">-</span>ymin))<span class="op">*</span>aspect, adjustable<span class="op">=</span><span class="st">&#39;box-forced&#39;</span>)</a></code></pre></div>
    <h2 id="座標軸の描画">座標軸の描画</h2>
    <p>以下のサンプルはどこぞからの拾い物。</p>
    <div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb19-1" title="1"><span class="co"># removing the default axis on all sides:</span></a>
    <a class="sourceLine" id="cb19-2" title="2"><span class="cf">for</span> side <span class="kw">in</span> [<span class="st">&#39;bottom&#39;</span>,<span class="st">&#39;right&#39;</span>,<span class="st">&#39;top&#39;</span>,<span class="st">&#39;left&#39;</span>]:</a>
    <a class="sourceLine" id="cb19-3" title="3">    ax.spines[side].set_visible(<span class="va">False</span>)</a>
    <a class="sourceLine" id="cb19-4" title="4"></a>
    <a class="sourceLine" id="cb19-5" title="5"><span class="co"># removing the axis ticks</span></a>
    <a class="sourceLine" id="cb19-6" title="6">plt.xticks([]) <span class="co"># labels</span></a>
    <a class="sourceLine" id="cb19-7" title="7">plt.yticks([])</a>
    <a class="sourceLine" id="cb19-8" title="8">ax.xaxis.set_ticks_position(<span class="st">&#39;none&#39;</span>) <span class="co"># tick markers</span></a>
    <a class="sourceLine" id="cb19-9" title="9">ax.yaxis.set_ticks_position(<span class="st">&#39;none&#39;</span>)</a>
    <a class="sourceLine" id="cb19-10" title="10"></a>
    <a class="sourceLine" id="cb19-11" title="11"><span class="co"># get width and height of axes object to compute</span></a>
    <a class="sourceLine" id="cb19-12" title="12"><span class="co"># matching arrowhead length and width</span></a>
    <a class="sourceLine" id="cb19-13" title="13">dps <span class="op">=</span> fig.dpi_scale_trans.inverted()</a>
    <a class="sourceLine" id="cb19-14" title="14">bbox <span class="op">=</span> ax.get_window_extent().transformed(dps)</a>
    <a class="sourceLine" id="cb19-15" title="15">width, height <span class="op">=</span> bbox.width, bbox.height</a>
    <a class="sourceLine" id="cb19-16" title="16"></a>
    <a class="sourceLine" id="cb19-17" title="17"><span class="co"># manual arrowhead width and length</span></a>
    <a class="sourceLine" id="cb19-18" title="18">hw <span class="op">=</span> <span class="fl">1.</span><span class="op">/</span><span class="fl">20.</span><span class="op">*</span>(ymax<span class="op">-</span>ymin)</a>
    <a class="sourceLine" id="cb19-19" title="19">hl <span class="op">=</span> <span class="fl">1.</span><span class="op">/</span><span class="fl">20.</span><span class="op">*</span>(xmax<span class="op">-</span>xmin)</a>
    <a class="sourceLine" id="cb19-20" title="20">lw <span class="op">=</span> <span class="fl">1.</span> <span class="co"># axis line width</span></a>
    <a class="sourceLine" id="cb19-21" title="21">ohg <span class="op">=</span> <span class="fl">0.3</span> <span class="co"># arrow overhang</span></a>
    <a class="sourceLine" id="cb19-22" title="22"></a>
    <a class="sourceLine" id="cb19-23" title="23"><span class="co"># compute matching arrowhead length and width</span></a>
    <a class="sourceLine" id="cb19-24" title="24">yhw <span class="op">=</span> hw<span class="op">/</span>(ymax<span class="op">-</span>ymin)<span class="op">*</span>(xmax<span class="op">-</span>xmin)<span class="op">*</span> height<span class="op">/</span>width</a>
    <a class="sourceLine" id="cb19-25" title="25">yhl <span class="op">=</span> hl<span class="op">/</span>(xmax<span class="op">-</span>xmin)<span class="op">*</span>(ymax<span class="op">-</span>ymin)<span class="op">*</span> width<span class="op">/</span>height</a>
    <a class="sourceLine" id="cb19-26" title="26"></a>
    <a class="sourceLine" id="cb19-27" title="27"><span class="co"># draw x and y axis</span></a>
    <a class="sourceLine" id="cb19-28" title="28">ax.arrow(xmin, <span class="dv">0</span>, xmax<span class="op">-</span>xmin, <span class="fl">0.</span>, fc<span class="op">=</span><span class="st">&#39;k&#39;</span>, ec<span class="op">=</span><span class="st">&#39;k&#39;</span>, lw <span class="op">=</span> lw,</a>
    <a class="sourceLine" id="cb19-29" title="29">         head_width<span class="op">=</span>hw, head_length<span class="op">=</span>hl, overhang <span class="op">=</span> ohg,</a>
    <a class="sourceLine" id="cb19-30" title="30">         length_includes_head<span class="op">=</span> <span class="va">True</span>, clip_on <span class="op">=</span> <span class="va">False</span>)</a>
    <a class="sourceLine" id="cb19-31" title="31">ax.arrow(<span class="dv">0</span>, ymin, <span class="fl">0.</span>, ymax<span class="op">-</span>ymin, fc<span class="op">=</span><span class="st">&#39;k&#39;</span>, ec<span class="op">=</span><span class="st">&#39;k&#39;</span>, lw <span class="op">=</span> lw,</a>
    <a class="sourceLine" id="cb19-32" title="32">         head_width<span class="op">=</span>yhw, head_length<span class="op">=</span>yhl, overhang <span class="op">=</span> ohg,</a>
    <a class="sourceLine" id="cb19-33" title="33">         length_includes_head<span class="op">=</span> <span class="va">True</span>, clip_on <span class="op">=</span> <span class="va">False</span>)</a></code></pre></div>
    <p>上のコマンドで座標軸を作ったら、そこに <code>ax.plot</code> で関数を描画したり、</p>
    <div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb20-1" title="1">phi <span class="op">=</span> patches.Circle(xy<span class="op">=</span>(x, y), radius<span class="op">=</span>r, fc<span class="op">=</span><span class="st">&#39;green&#39;</span>)</a>
    <a class="sourceLine" id="cb20-2" title="2">ax.add_patch(phi)</a></code></pre></div>
    <p>で円を描いたり出来る。</p>
    <h2 id="図への書き込み">図への書き込み</h2>
    <p>プレゼン用に図に星印などつけたい場合は、</p>
    <div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb21-1" title="1">ax.plot(x, y, <span class="st">&#39;*&#39;</span>, markersize<span class="op">=</span><span class="dv">15</span>, color<span class="op">=</span><span class="st">&#39;black&#39;</span>, clip_on<span class="op">=</span><span class="va">False</span>)</a></code></pre></div>
    <p>とする。<code>clip_on=False</code> を指定すると、点が図の領域からはみ出た場合も、はみ出た部分を含めて全て描画してくれる。 また、矢印付き、なしの文字の書き込みが</p>
    <div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb22-1" title="1">ax.annotate(<span class="st">&#39;Text&#39;</span>, xy<span class="op">=</span>[x, y], xytext<span class="op">=</span>[xtext, ytext], arrowprops<span class="op">=</span><span class="bu">dict</span>(width<span class="op">=</span><span class="dv">4</span>, color<span class="op">=</span><span class="st">&#39;b&#39;</span>), fontsize<span class="op">=</span><span class="dv">30</span>, color<span class="op">=</span><span class="st">&#39;b&#39;</span>)</a>
    <a class="sourceLine" id="cb22-2" title="2">ax.annotate(<span class="st">&#39;Text&#39;</span>, xy<span class="op">=</span>(xtext, ytext), fontsize<span class="op">=</span><span class="dv">20</span>)</a></code></pre></div>
    <p>などで可能。</p>
    <h2 id="図を分割">図を分割</h2>
    <p><code>matplotlib.axes.Axes</code> インスタンスを準備する部分を</p>
    <div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb23-1" title="1">ax1  <span class="op">=</span> fig.add_subplot(N,x,y)</a></code></pre></div>
    <p>などと変更する。ここで <code>N</code> は図の総数で、<code>x</code>, <code>y</code> が <code>ax1</code> の図の座標に対応する。</p>
    <h2 id="漫画風のプロット">漫画風のプロット</h2>
    <div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb24-1" title="1">plt.xkcd()</a></code></pre></div>
    </div>
    </div>
    <!-- Contents above -->
  </div>
</div>

<!-- insertion below : footer.html -->
<footer>
  <small>Copyright(C)2019 S. Chigusa, All Rights Reserved.</small>
</footer>
<!-- insertion above : footer.html -->

</body>
</html>
